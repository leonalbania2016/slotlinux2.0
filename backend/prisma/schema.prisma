// Prisma schema
// Switch provider to postgresql on Render if preferred (and update DATABASE_URL)


generator client {
provider = "prisma-client-js"
}


datasource db {
provider = "sqlite"
url = env("DATABASE_URL")
}


model User {
id String @id @default(cuid())
discordId String @unique
username String
discriminator String
avatar String?
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
slotConfigs SlotConfig[]
}


model SlotConfig {
id String @id @default(cuid())
userId String
guildId String // Discord guild id
background String // filename under frontend/src/assets/gifs
slotCount Int
messageId String? // Discord message id for last sent slots
channelId String? // Last channel used for sending
updatedAt DateTime @updatedAt
createdAt DateTime @default(now())


user User @relation(fields: [userId], references: [id])
slots Slot[]


@@unique([userId, guildId])
}


model Slot {
id String @id @default(cuid())
slotConfigId String
position Int // 0..(slotCount-1)
emoji String // emoji id or unicode literal
updatedAt DateTime @updatedAt
createdAt DateTime @default(now())


slotConfig SlotConfig @relation(fields: [slotConfigId], references: [id])


@@unique([slotConfigId, position])
}